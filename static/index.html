<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Usuarios</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        form { margin-bottom: 20px; }
        input { padding: 10px; margin: 5px; }
        button { padding: 10px; cursor: pointer; }
        .user-list { margin-top: 20px; }
        .user-item { margin: 10px 0; }
    </style>
</head>
<body>

    <h1>Gesti√≥n de Usuarios</h1>

    <!-- Formulario para agregar usuario -->
    <form id="userForm">
        <input type="text" id="nombre" placeholder="Nombre" required>
        <input type="email" id="correo" placeholder="Correo" required>
        <button type="submit">Registrar Usuario</button>
    </form>

    <h2>Usuarios Registrados</h2>
    <div class="user-list" id="userList"></div>

    <script>
        // üîπ Detectar si estamos en local o en producci√≥n (Render)
        const LOCAL_API_URL = "http://127.0.0.1:8000/usuarios/";
        const PUBLIC_API_URL = "https://mywebhtmlp.onrender.com/usuarios/";

        const API_URL = window.location.hostname.includes("localhost") || window.location.hostname.includes("127.0.0.1") 
                        ? LOCAL_API_URL 
                        : PUBLIC_API_URL;

        console.log("Conectando a:", API_URL); // Para verificar en consola

        // Funci√≥n para obtener y mostrar usuarios
        function obtenerUsuarios() {
            fetch(API_URL)
                .then(response => {
                    if (!response.ok) throw new Error(`Error: ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    const userList = document.getElementById("userList");
                    userList.innerHTML = ""; // Limpiar la lista antes de agregar nuevos datos

                    data.forEach(usuario => {
                        const div = document.createElement("div");
                        div.classList.add("user-item");
                        div.innerHTML = `
                            <strong>${usuario.nombre}</strong> - ${usuario.correo}
                            <button onclick="eliminarUsuario(${usuario.id})">‚ùå Eliminar</button>
                        `;
                        userList.appendChild(div);
                    });
                })
                .catch(error => console.error("Error al obtener usuarios:", error));
        }

        // Funci√≥n para registrar un usuario
        document.getElementById("userForm").addEventListener("submit", function(event) {
            event.preventDefault();
            
            const nombre = document.getElementById("nombre").value;
            const correo = document.getElementById("correo").value;

            fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ nombre, correo })
            })
            .then(response => {
                if (!response.ok) throw new Error(`Error: ${response.status}`);
                return response.json();
            })
            .then(() => {
                obtenerUsuarios(); // Actualiza la lista de usuarios
                document.getElementById("userForm").reset(); // Limpia el formulario
            })
            .catch(error => console.error("Error al registrar usuario:", error));
        });

        // Funci√≥n para eliminar un usuario
        function eliminarUsuario(usuario_id) {
            fetch(`${API_URL}${usuario_id}`, { method: "DELETE" })
                .then(response => {
                    if (!response.ok) throw new Error(`Error: ${response.status}`);
                    obtenerUsuarios();
                })
                .catch(error => console.error("Error al eliminar usuario:", error));
        }

        // Cargar usuarios al cargar la p√°gina
        obtenerUsuarios();
    </script>

</body>
</html>
